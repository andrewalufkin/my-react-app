version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 12

  pre_build:
    commands:
      - cd backend  # Change directory to the backend folder
      - npm install  # Install backend dependencies

  build:
    commands:
      - cd ../frontend  # Change back to the frontend folder
      - npm install # Install frontend dependencies
      - npm run build  # Build the frontend

# Add the deploy phase for CodeDeploy
  deploy:
    commands:
      # Add commands to deploy using CodeDeploy here
      #- aws deploy create-deployment --application-name simple-web-app --deployment-group-name deployment-group-1 --s3-location bucket=codepipeline-us-east-1-351157913410,bundleType=zip,key=frontend/build.zip
      - aws deploy create-deployment --application-name simple-web-app --deployment-group-name deployment-group-1 --s3-location bucket=codepipeline-us-east-1-351157913410,bundleType=zip,key=backend.zip

artifacts:
  files:
    - backend/**/*  # Include backend build artifacts
    - frontend/build/**/*  # Include frontend build artifacts

# Add the ArtifactsOverride section
ArtifactsOverride:
  files:
    - backend/**/*  # Include backend build artifacts
    - frontend/build/**/*  # Include frontend build artifacts